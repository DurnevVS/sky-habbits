# Sky-habbits

## Как запускать проект
1. Установить зависимости проекта
2. Заполнить .env файл необходимыми переменными окружения, инструкция по заполнению в .template.env
3. Запустить и настроить Postgres, Redis
3. Выполнить миграции
```
python manage.py migrate
```
4. Создать необходимые для работы объекты моделей
```
python manage.py createintervals
```
5. Запустить сервер
```
python manage.py runserver
```
6. Запустить port-forwarding, в качестве примера ngrok
```
ngrok http http://localhost:8000
```
7. Создать супер юзера (опционально)
```
python manage.py createsuperuser
```

## Доступные эндпоинты
При запуске сервера будет доступен ендпоинт с документацией (Для тестирования апи по сваггеру заходить с localhost)
```
http://127.0.0.1:8000/swagger/
```

## Аутентификация через телеграм
1. Получить токен бота у @BotFather https://t.me/BotFather
2. Задать боту доменный адрес, с которого идет port-forward на localhost 
3. Чтобы зарегистрироваться или войти с помощью телеграма есть ендпоинд /users/login/telegram/
в ответ придет url адрес, по которому открывается окно телеграма, если домен бота задан верно
(WARN: после регистрации происходит редирект на /widgets/telegram-widget-preview/ 
по умолчанию этот адрес задается самим js скриптом виджета, который располагается по этому адресу,
изменить этот адрес нельзя, для использования в продакшене скачать html виджета по ендпоинту /widgets/telegram-widget/ 
вставить html себе в документ, тогда редирект будет на адрес, на котором будет располагаться виджет)
4. После регистрации в джанговский request.user подставляется созданный юзер с related manager моделью social_auth
(https://drf-social-oauth2.readthedocs.io/en/latest/)
5. Для тестирования АПИ от пользователя телеграма не использовать сваггер!

## Базовая аутентификация
1. В качестве аутентификации по текену используется измененный "rest_framework.authtoken"
  * Регистрируемся /users/register/
  * Получаем токен /users/login/
  * В заголовок authorization передаем: Bearer <token>

2. Поддерживается Базовая аутентификация, в таком случае просто задаем логин-пароль 

